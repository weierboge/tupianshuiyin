<html>
<head>
    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 0;
        }

        h1 {
            text-align: center;
            color: #333;
            font-size: 36px;
            margin-top: 50px;
        }

        .container {
            width: 800px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .input {
            margin-top: 20px;
        }

        .input label {
            display: block;
            font-size: 18px;
            color: #333;
        }

        .input input[type="file"] {
            display: none;
        }

        .input button {
            width: 200px;
            height: 50px;
            border: none;
            border-radius: 10px;
            background-color: #007aff;
            color: white;
            font-size: 18px;
            cursor: pointer;
        }

        .input button:hover {
            background-color: #0051c7;
        }

        .output {
            margin-top: 20px;
        }

        .output label {
            display: block;
            font-size: 18px;
            color: #333;
        }

        .output canvas {
            width: 600px;
            height: 400px;
            border: 1px solid #ccc;
        }

        .output button {
            width: 200px;
            height: 50px;
            border: none;
            border-radius: 10px;
            background-color: #007aff;
            color: white;
            font-size: 18px;
            cursor: pointer;
        }

        .output button:hover {
            background-color: #0051c7;
        }

        .settings {
            margin-top: 20px;
        }

        .settings label {
            display: block;
            font-size: 18px;
            color: #333;
        }

        .settings input[type="number"] {
            width: 100px;
            height: 30px;
            border-radius: 5px; 
        }
    </style>
</head>
<body>
    <h1>给图片自定义添加水印的纯前端小工具</h1>
    <div class="container">
        <div class="input">
          <label for="file">选择图片</label>
          <input type="file" id="file" accept="image/*" onchange="loadImage()">
          <button id="upload">上传图片</button>
      </div>
      <div class="output">
          <label for="canvas">预览效果</label>
          <canvas id="canvas"></canvas>
          <button id="download">生成图片</button>
      </div>
      <div class="settings">
          <label for="text">水印文字</label>
          <input type="text" id="text" value="Bing" onchange="drawWatermark()">
          <label for="number">水印数量</label>
          <input type="number" id="number" value="5" min="1" max="10" onchange="drawWatermark()">
          <label for="size">水印大小</label>
          <input type="number" id="size" value="50" min="10" max="100" onchange="drawWatermark()">
          <label for="angle">水印角度</label>
          <input type="number" id="angle" value="-45" min="-90" max="90" onchange="drawWatermark()">
      </div>
    </div>

    <script>
      // 获取元素
      var file = document.getElementById("file");
      var upload = document.getElementById("upload");
      var canvas = document.getElementById("canvas");
      var download = document.getElementById("download");
      var text = document.getElementById("text");
      var number = document.getElementById("number");
      var size = document.getElementById("size");
      var angle = document.getElementById("angle");

      // 创建图片对象
      var image = new Image();

      // 创建画布上下文
      var ctx = canvas.getContext("2d");

      // 加载图片
      function loadImage() {
        // 获取文件对象
        var fileObj = file.files[0];
        // 创建文件读取器
        var reader = new FileReader();
        // 读取文件为数据URL
        reader.readAsDataURL(fileObj);
        // 监听读取完成事件
        reader.onload = function() {
          // 设置图片源为数据URL
          image.src = this.result;
          // 监听图片加载事件
          image.onload = function() {
            // 绘制图片到画布
            drawImage();
            // 绘制水印到画布
            drawWatermark();
          }
        }
      }

      // 绘制图片
      function drawImage() {
        // 清空画布
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        // 计算图片缩放比例
        var scale = Math.min(canvas.width / image.width, canvas.height / image.height);
        // 计算图片绘制位置和大小
        var x = (canvas.width - image.width * scale) / 2;
        var y = (canvas.height - image.height * scale) / 2;
        var w = image.width * scale;
        var h = image.height * scale;
        // 绘制图片到画布
        ctx.drawImage(image, x, y, w, h);
      }

      // 绘制水印
      function drawWatermark() {
        // 获取水印文字
        var txt = text.value;
        // 获取水印数量
        var num = number.value;
        // 获取水印大小
        var s = size.value;
        // 获取水印角度（转换为弧度）
        var a = angle.value * Math.PI / 180;
        // 设置字体样式
        ctx.font = s + "px Arial";
        // 设置字体颜色（半透明）
        ctx.fillStyle = "rgba(0, 0, 0, 0.5)";
        // 设置文本对齐方式（居中）
        ctx.textAlign = "center";
        // 设置文本基线（中间）
        ctx.textBaseline = "middle";
        
        // 计算水印间隔（根据角度和大小）
        var dx = s * Math.cos(a);
        var dy = s * Math.sin(a);

        // 遍历水印数量，绘制每个水印
        for (var i = 0; i < num; i++) {
          // 计算水印位置（根据索引和间隔）
          var x = canvas.width / 2 + i * dx;
          var y = canvas.height / 2 + i * dy;

          // 保存画布状态
          ctx.save();
          // 移动画布原点到水印位置
          ctx.translate(x, y);
          // 旋转画布到水印角度
          ctx.rotate(a);
          // 绘制水印文字到画布
          ctx.fillText(txt, 0, 0);
          // 恢复画布状态
          ctx.restore();
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          

        }
      }

      // 上传图片
      upload.onclick = function() {
        // 触发文件选择器的点击事件
        file.click();
      }

      // 生成图片
      download.onclick = function() {
        // 获取画布的数据URL
        var dataURL = canvas.toDataURL();
        // 创建下载链接
        var link = document.createElement("a");
        // 设置下载链接的属性
        link.href = dataURL;
        link.download = "watermarked-image.png";
        // 触发下载链接的点击事件
        link.click();
      }
    </script>
</body>
</html>
