<html>
<head>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        .container {
            width: 80%;
            max-width: 800px;
            margin: 20px auto;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 18px;
            color: #666;
            margin-bottom: 20px;
        }

        .input {
            width: 100%;
            height: 40px;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            font-size: 16px;
        }

        .input-file {
            display: none;
        }

        .label-file {
            width: 100%;
            height: 40px;
            border: 1px dashed #ccc;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .button {            width: 100%;
            height: 40px;
            border: none;
            border-radius: 5px;
            background-color: #0099ff;
            color: white;
            font-size: 16px;
            cursor: pointer;
        }

        .preview {
            width: 100%;
            max-width: 600px;
            height: auto;
            margin-top: 20px;
            position: relative;
        }

        .watermark {
            position: absolute;
            font-size: 24px;
            color: white;
            opacity: 0.8;
            transform: rotate(45deg);
        }

        .slider {
            width: 100%;
            height: 20px;
            margin-top: 10px;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
        }

        .slider-value {
            width: 40px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="title">图片水印小工具</div>
        <div class="subtitle">请上传一张图片，并输入你想要添加的水印文字</div>
        <form id="form">
            <input type="file" id="input-file" class="input input-file" accept="image/*" required>
            <label for="input-file" id="label-file" class="input label-file">点击这里选择图片</label>
            <input type="text" id="input-text" class="input" placeholder="请输入水印文字" required>
            <div class="slider-label">
                <span>水印数量</span>
                <span id="number-value">1</span>
            </div>
            <input type="range" id="input-number" class="slider" min="1" max="10" value="1">
            <div class="slider-label">
                <span>水印大小</span>
                <span id="size-value">24</span>
            </div>
            <input type="range" id="input-size" class="slider" min="12" max="48" value="24">
            <div class="slider-label">
                <span>水印角度</span>
                <span id="angle-value">45</span>
            </div>
            <input type="range" id="input-angle" class="slider" min="-90" max="90" value="45">
        </form>
        <img src="" id="preview-image" class="preview">
    </div>

    <script>
        // 获取元素
        const inputFile = document.getElementById("input-file");
        const labelFile = document.getElementById("label-file");
        const inputText = document.getElementById("input-text");
        const inputNumber = document.getElementById("input-number");
        const numberValue = document.getElementById("number-value");
        const inputSize = document.getElementById("input-size");
        const sizeValue = document.getElementById("size-value");
        const inputAngle = document.getElementById("input-angle");
        const angleValue = document.getElementById("angle-value");
        const previewImage = document.getElementById("preview-image");

        // 定义变量
        let imageFile; // 图片文件
        let watermarkText; // 水印文字
        let watermarkNumber; // 水印数量
        let watermarkSize; // 水印大小
        let watermarkAngle; // 水印角度

        // 定义函数
        function drawImage() {
            // 判断是否有图片和文字
            if (imageFile && watermarkText) {
                // 创建画布元素
                const canvas = document.createElement("canvas");
                // 获取画布上下文
                const context = canvas.getContext("2d");
                // 创建图片元素
                const image = new Image();
                image.src = previewImage.src;
                image.onload = function() {
                    // 设置画布的宽高和图片一致
                    canvas.width = image.width;
                    canvas.height = image.height;
                    // 在画布上绘制图片
                    context.drawImage(image, 0, 0);
                    // 设置水印的样式
                    context.font = `${watermarkSize}px Arial`;
                    context.fillStyle = "white";
                    context.textAlign = "right";
                    context.textBaseline = "bottom";
                    context.globalAlpha = 0.8;
                    context.rotate(watermarkAngle * Math.PI / 180);
                    // 计算水印的位置和间距
                    const marginX = 10;
                    const marginY = 10;
                    const offsetX = canvas.width - marginX;
                    const offsetY = canvas.height - marginY;
                    const spacingX = context.measureText(watermarkText).width + marginX * 2;
                    const spacingY = watermarkSize + marginY * 2;
                    // 循环绘制水印
                    for (let i = 0; i < watermarkNumber; i++) {
                        for (let j = 0; j < watermarkNumber; j++) {
                            context.fillText(watermarkText, offsetX - i * spacingX, offsetY - j * spacingY);
                        }
                    }
                    // 将画布转换为图片URL并显示在预览区域
                    previewImage.src = canvas.toDataURL();
                };
            } else {
                // 设置预览区域为纯白色
                previewImage.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==";
            }
        }

        // 监听文件输入框的变化
        inputFile.addEventListener("change", function() {
            // 获取选择的文件
            imageFile = this.files[0];
            // 读取文件内容
            const reader = new FileReader();
            reader.readAsDataURL(imageFile);
            reader.onload = function() {
                // 显示文件名
                labelFile.textContent = imageFile.name;
                // 预览图片
                previewImage.src = this.result;
                // 绘制水印图片
                drawImage();
            };
        });

        // 监听文本输入框的变化
        inputText.addEventListener("input", function() {
            // 获取输入的文字
            watermarkText = this.value;
            // 绘制水印图片
            drawImage();
        });

        // 监听数量滑块的变化
        inputNumber.addEventListener("input", function() {
            // 获取滑块的值
            watermarkNumber = this.value;
            // 显示滑块的值
            numberValue.textContent = watermarkNumber;
            // 绘制水印图片
            drawImage();
        });

        // 监听大小滑块的变化
        inputSize.addEventListener("input", function() {
            // 获取滑块的值
            watermarkSize = this.value;
            // 显示滑块的值
            sizeValue.textContent = watermarkSize;
            // 绘制水印图片
            drawImage();
        });

        // 监听角度滑块的变化
        inputAngle.addEventListener("input", function() {
            // 获取滑块的值
            watermarkAngle = this.value;
            // 显示滑块的值
            angleValue.textContent = watermarkAngle;
            // 绘制水印图片
            drawImage();
        });
    </script>
</body>
</html>

